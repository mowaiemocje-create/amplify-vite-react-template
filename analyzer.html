<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voice Spectrum Analyzer Mobile</title>
<style>
:root {
  --primary-color: #4cc9f0;
  --secondary-color: #4361ee;
  --background-dark: #121212;
  --background-light: #252525;
  --text-color: #fff;
}
body { margin:0; padding:0; font-family:sans-serif; background:var(--background-dark); color:var(--text-color);}
canvas { width:100%; height:300px; display:block; background:var(--background-light);}
button { padding:10px 20px; margin:5px; border:none; border-radius:50px; background:var(--primary-color); color:#000; font-weight:600; }
</style>
</head>
<body>

<h1 style="text-align:center;">Voice Spectrum Analyzer</h1>
<canvas id="waveform"></canvas>
<div style="text-align:center;">
  <button id="startBtn">Start</button>
  <button id="stopBtn" disabled>Stop</button>
</div>

<script>
let audioContext, analyser, dataArray, source, animationId;
const canvas = document.getElementById("waveform");
const ctx = canvas.getContext("2d");
const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");
let isActive = false;

function draw() {
  if(!isActive) return;
  analyser.getByteTimeDomainData(dataArray);
  ctx.fillStyle = '#252525';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.strokeStyle = '#4cc9f0';
  ctx.beginPath();
  const sliceWidth = canvas.width / dataArray.length;
  let x=0;
  for(let i=0;i<dataArray.length;i++){
    const v = dataArray[i]/128.0;
    const y = v * canvas.height/2;
    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    x+=sliceWidth;
  }
  ctx.lineTo(canvas.width,canvas.height/2);
  ctx.stroke();
  animationId = requestAnimationFrame(draw);
}

startBtn.onclick = async () => {
  if(isActive) return;
  try{
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const stream = await navigator.mediaDevices.getUserMedia({audio:true});
    source = audioContext.createMediaStreamSource(stream);
    analyser = audioContext.createAnalyser();
    analyser.fftSize = 2048;
    dataArray = new Uint8Array(analyser.frequencyBinCount);
    source.connect(analyser);
    isActive = true;
    startBtn.disabled = true;
    stopBtn.disabled = false;
    draw();
  } catch(e){
    alert('Błąd mikrofonu: ' + e.message);
  }
};

stopBtn.onclick = () => {
  if(!isActive) return;
  cancelAnimationFrame(animationId);
  if(audioContext){ audioContext.close(); audioContext=null;}
  isActive=false;
  startBtn.disabled=false;
  stopBtn.disabled=true;
};
</script>
</body>
</html>
